<!-- Skip Navigation Link for Accessibility -->
<a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-0 focus:left-0 bg-primary-600 text-white px-4 py-2 z-50">Skip to main content</a>

<nav
  class="fixed top-0 z-50 w-full flex flex-wrap items-center justify-between px-2 py-3 navbar-expand-lg bg-gray-800 transition-all duration-300 ease-in-out"
  id="main-navbar"
  role="navigation" aria-label="Main navigation">
  <div class="container px-4 mx-auto flex flex-wrap items-center justify-between">
    <div class="w-full relative flex justify-between lg:w-auto lg:static lg:block lg:justify-start">
      {% assign current_lang = page.lang | default: site.default_lang | default: "zh" %}
      {% if current_lang == "en" %}
        {% assign home_url = "/en/" %}
      {% else %}
        {% assign home_url = "/" %}
      {% endif %}
      
      <a class="flex items-center text-sm font-bold leading-relaxed inline-block mr-4 py-2 whitespace-nowrap text-white"
        href="{{ home_url }}">
        <img class="w-8 h-8 mr-2" src="{{ '/assets/img/logo.svg' | relative_url }}" alt="{% include translate.html key='site.company_name' %}" />
        <span class="hidden sm:inline">{% include translate.html key='site.company_name' %}</span>
      </a>
      <button
        class="cursor-pointer text-xl leading-none px-3 py-1 border border-solid border-transparent rounded bg-transparent block lg:hidden outline-none focus:outline-none"
        type="button" id="mobile-menu-button" aria-label="Toggle mobile menu">
        <i class="text-white fas fa-bars" id="menu-icon"></i>
      </button>
    </div>
    <div class="lg:flex flex-grow items-center bg-white lg:bg-transparent lg:shadow-none hidden"
      id="example-collapse-navbar">
      {% assign current_lang = page.lang | default: site.default_lang | default: "zh" %}
      {% if current_lang == "en" %}
        {% assign lang_prefix = "/en" %}
      {% else %}
        {% assign lang_prefix = "" %}
      {% endif %}
      
      <ul class="flex flex-col lg:flex-row list-none mr-auto">
        <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-gray-300 text-gray-800 px-3 py-4 lg:py-2 flex items-center text-xs uppercase font-bold"
            href="{{ lang_prefix }}/"><i class="lg:text-gray-300 text-gray-500 fas fa-home text-lg leading-lg mr-2"></i>
            {% include translate.html key='nav.home' %}</a>
        </li>
        <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-gray-300 text-gray-800 px-3 py-4 lg:py-2 flex items-center text-xs uppercase font-bold"
            href="{{ lang_prefix }}/services"><i class="lg:text-gray-300 text-gray-500 fas fa-shield-alt text-lg leading-lg mr-2"></i>
            {% include translate.html key='nav.services' %}</a>
        </li>
        <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-gray-300 text-gray-800 px-3 py-4 lg:py-2 flex items-center text-xs uppercase font-bold"
            href="{{ lang_prefix }}/team"><i class="lg:text-gray-300 text-gray-500 fas fa-users text-lg leading-lg mr-2"></i>
            {% include translate.html key='nav.team' %}</a>
        </li>
        <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-gray-300 text-gray-800 px-3 py-4 lg:py-2 flex items-center text-xs uppercase font-bold"
            href="{{ lang_prefix }}/blog"><i class="lg:text-gray-300 text-gray-500 far fa-file-alt text-lg leading-lg mr-2"></i>
            {% include translate.html key='nav.blog' %}</a>
        </li>
        <!-- <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-gray-300 text-gray-800 px-3 py-4 lg:py-2 flex items-center text-xs uppercase font-bold"
            href="{{ lang_prefix }}/calculators"><i class="lg:text-gray-300 text-gray-500 fas fa-calculator text-lg leading-lg mr-2"></i>
            {% if current_lang == "zh" %}计算器{% else %}Calculators{% endif %}</a>
        </li> -->
        <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-gray-300 text-gray-800 px-3 py-4 lg:py-2 flex items-center text-xs uppercase font-bold"
            href="{{ lang_prefix }}/faq"><i class="lg:text-gray-300 text-gray-500 fas fa-question-circle text-lg leading-lg mr-2"></i>
            FAQ</a>
        </li>
        <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-gray-300 text-gray-800 px-3 py-4 lg:py-2 flex items-center text-xs uppercase font-bold"
            href="{{ lang_prefix }}/glossary"><i class="lg:text-gray-300 text-gray-500 fas fa-book text-lg leading-lg mr-2"></i>
            {% if current_lang == "zh" %}术语表{% else %}Glossary{% endif %}</a>
        </li>
        <!-- <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-gray-300 text-gray-800 px-3 py-4 lg:py-2 flex items-center text-xs uppercase font-bold"
            href="{{ lang_prefix }}/disclosure"><i class="lg:text-gray-300 text-gray-500 fas fa-file-contract text-lg leading-lg mr-2"></i>
            {% include translate.html key='nav.disclosure' %}</a>
        </li> -->
        <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-gray-300 text-gray-800 px-3 py-4 lg:py-2 flex items-center text-xs uppercase font-bold"
            href="{{ lang_prefix }}/contact-us"><i class="lg:text-gray-300 text-gray-500 fas fa-envelope text-lg leading-lg mr-2"></i>
            {% include translate.html key='nav.contact' %}</a>
        </li>
        <li class="flex items-center lg:hidden">
          <button class="search-trigger text-gray-800 px-3 py-4 flex items-center text-xs uppercase font-bold hover:text-primary-600 transition duration-200">
            <i class="text-gray-500 fas fa-search text-lg leading-lg mr-2"></i>
            {% if current_lang == "zh" %}搜索{% else %}Search{% endif %}
          </button>
        </li>
      </ul>
      
      <!-- Search Button -->
      <div class="hidden lg:flex items-center ml-4">
        <button class="search-trigger text-white hover:text-gray-300 p-2 rounded-lg hover:bg-white hover:bg-opacity-10 transition duration-200" 
                title="{% if current_lang == 'zh' %}搜索 (Ctrl+K){% else %}Search (Ctrl+K){% endif %}">
          <i class="fas fa-search text-lg"></i>
        </button>
      </div>
      
      <!-- Language Switcher -->
      <div class="hidden lg:flex items-center ml-4">
        {% include language-switcher.html %}
      </div>
    </div>
  </div>
</nav>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('example-collapse-navbar');
  const menuIcon = document.getElementById('menu-icon');
  const navbar = document.getElementById('main-navbar');
  
  // Mobile menu functionality
  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener('click', function() {
      // Toggle the hidden class
      mobileMenu.classList.toggle('hidden');
      
      // Toggle the menu icon between bars and times
      if (mobileMenu.classList.contains('hidden')) {
        menuIcon.className = 'text-white fas fa-bars';
      } else {
        menuIcon.className = 'text-white fas fa-times';
      }
    });
    
    // Close menu when clicking on a link (for better UX)
    const menuLinks = mobileMenu.querySelectorAll('a');
    menuLinks.forEach(function(link) {
      link.addEventListener('click', function() {
        mobileMenu.classList.add('hidden');
        menuIcon.className = 'text-white fas fa-bars';
      });
    });
  }
  
  // Scroll behavior functionality (like Pinnacle Life)
  let lastScrollTop = 0;
  let ticking = false;
  
  function updateNavbar() {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    
    // Add background opacity when scrolled
    if (scrollTop > 50) {
      navbar.style.backgroundColor = 'rgba(31, 41, 55, 0.95)'; // gray-800 with opacity
      navbar.style.backdropFilter = 'blur(10px)';
    } else {
      navbar.style.backgroundColor = 'rgb(31, 41, 55)'; // solid gray-800
      navbar.style.backdropFilter = 'none';
    }
    
    // If at the top of the page, always show navbar
    if (scrollTop <= 100) {
      navbar.style.transform = 'translateY(0)';
    }
    // If scrolling down, hide navbar
    else if (scrollTop > lastScrollTop && scrollTop > 100) {
      navbar.style.transform = 'translateY(-100%)';
    }
    // If scrolling up, show navbar
    else if (scrollTop < lastScrollTop) {
      navbar.style.transform = 'translateY(0)';
    }
    
    lastScrollTop = scrollTop;
    ticking = false;
  }
  
  function requestTick() {
    if (!ticking) {
      requestAnimationFrame(updateNavbar);
      ticking = true;
    }
  }
  
  // Listen for scroll events
  window.addEventListener('scroll', requestTick, { passive: true });
  
  // Also handle resize events to ensure proper behavior
  window.addEventListener('resize', function() {
    // Reset navbar position on resize
    if (window.innerWidth >= 1024) { // lg breakpoint
      navbar.style.transform = 'translateY(0)';
    }
  });
});
</script>