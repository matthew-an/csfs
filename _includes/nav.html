<!-- Skip Navigation Link for Accessibility -->
<a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-0 focus:left-0 bg-primary-600 text-white px-4 py-2 z-50 rounded-br-lg">Skip to main content</a>

<nav
  class="fixed top-0 z-50 w-full transition-all duration-300 ease-in-out glass-effect border-b border-white/10"
  id="main-navbar"
  role="navigation" aria-label="Main navigation"
  style="background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px);">
  
  <!-- Modern Navigation Indicator -->
  <div class="absolute bottom-0 left-0 h-0.5 bg-gradient-to-r from-primary-400 to-primary-600 transition-all duration-300" id="nav-indicator"></div>
  <div class="container px-4 mx-auto flex flex-wrap items-center justify-between">
    <div class="w-full relative flex justify-between lg:w-auto lg:static lg:block lg:justify-start">
      {% assign current_lang = page.lang | default: site.default_lang | default: "zh" %}
      {% if current_lang == "en" %}
        {% assign home_url = "/en/" %}
      {% else %}
        {% assign home_url = "/" %}
      {% endif %}
      
      <a class="flex items-center text-lg font-bold leading-relaxed inline-block mr-4 py-3 whitespace-nowrap text-white hover:text-primary-200 transition-colors duration-200"
        href="{{ home_url }}">
        <img class="w-10 h-10 mr-3 transition-transform duration-200 hover:scale-105" src="{{ '/assets/img/logo.svg' | relative_url }}" alt="{% include translate.html key='site.company_name' %}" />
        <span class="hidden sm:inline font-heading">{% include translate.html key='site.company_name' %}</span>
      </a>
      <button
        class="cursor-pointer text-xl leading-none px-4 py-2 border border-white/20 rounded-lg bg-white/10 hover:bg-white/20 block lg:hidden outline-none focus:outline-none transition-all duration-200 hover:scale-105"
        type="button" id="mobile-menu-button" aria-label="Toggle mobile menu">
        <i class="text-white fas fa-bars transition-transform duration-200" id="menu-icon"></i>
      </button>
    </div>
    <div class="lg:flex flex-grow items-center bg-white/95 backdrop-blur-md lg:bg-transparent lg:shadow-none hidden rounded-lg lg:rounded-none mt-2 lg:mt-0 border lg:border-none border-white/20"
      id="example-collapse-navbar">
      {% assign current_lang = page.lang | default: site.default_lang | default: "zh" %}
      {% if current_lang == "en" %}
        {% assign lang_prefix = "/en" %}
      {% else %}
        {% assign lang_prefix = "" %}
      {% endif %}
      
      <ul class="flex flex-col lg:flex-row list-none mr-auto p-2 lg:p-0">
        <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-primary-200 text-gray-800 hover:text-primary-600 px-4 py-3 lg:py-2 flex items-center nav-typography rounded-lg lg:rounded-none hover:bg-primary-50 lg:hover:bg-white/10 transition-all duration-200 relative group"
            href="{{ lang_prefix }}/">
            <i class="lg:text-primary-200 text-primary-500 fas fa-home text-sm mr-3 group-hover:scale-110 transition-transform duration-200"></i>
            {% include translate.html key='nav.home' %}
            <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary-400 group-hover:w-full transition-all duration-300 lg:block hidden"></span>
          </a>
        </li>
        <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-primary-200 text-gray-800 hover:text-primary-600 px-4 py-3 lg:py-2 flex items-center nav-typography rounded-lg lg:rounded-none hover:bg-primary-50 lg:hover:bg-white/10 transition-all duration-200 relative group"
            href="{{ lang_prefix }}/services">
            <i class="lg:text-primary-200 text-primary-500 fas fa-shield-alt text-sm mr-3 group-hover:scale-110 transition-transform duration-200"></i>
            {% include translate.html key='nav.services' %}
            <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary-400 group-hover:w-full transition-all duration-300 lg:block hidden"></span>
          </a>
        </li>
        <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-primary-200 text-gray-800 hover:text-primary-600 px-4 py-3 lg:py-2 flex items-center nav-typography rounded-lg lg:rounded-none hover:bg-primary-50 lg:hover:bg-white/10 transition-all duration-200 relative group"
            href="{{ lang_prefix }}/team">
            <i class="lg:text-primary-200 text-primary-500 fas fa-users text-sm mr-3 group-hover:scale-110 transition-transform duration-200"></i>
            {% include translate.html key='nav.team' %}
            <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary-400 group-hover:w-full transition-all duration-300 lg:block hidden"></span>
          </a>
        </li>
        <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-primary-200 text-gray-800 hover:text-primary-600 px-4 py-3 lg:py-2 flex items-center nav-typography rounded-lg lg:rounded-none hover:bg-primary-50 lg:hover:bg-white/10 transition-all duration-200 relative group"
            href="{{ lang_prefix }}/blog">
            <i class="lg:text-primary-200 text-primary-500 far fa-file-alt text-sm mr-3 group-hover:scale-110 transition-transform duration-200"></i>
            {% include translate.html key='nav.blog' %}
            <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary-400 group-hover:w-full transition-all duration-300 lg:block hidden"></span>
          </a>
        </li>
        <!-- <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-gray-300 text-gray-800 px-3 py-4 lg:py-2 flex items-center text-xs uppercase font-bold"
            href="{{ lang_prefix }}/calculators"><i class="lg:text-gray-300 text-gray-500 fas fa-calculator text-lg leading-lg mr-2"></i>
            {% if current_lang == "zh" %}计算器{% else %}Calculators{% endif %}</a>
        </li> -->
        <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-primary-200 text-gray-800 hover:text-primary-600 px-4 py-3 lg:py-2 flex items-center nav-typography rounded-lg lg:rounded-none hover:bg-primary-50 lg:hover:bg-white/10 transition-all duration-200 relative group"
            href="{{ lang_prefix }}/faq">
            <i class="lg:text-primary-200 text-primary-500 fas fa-question-circle text-sm mr-3 group-hover:scale-110 transition-transform duration-200"></i>
            FAQ
            <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary-400 group-hover:w-full transition-all duration-300 lg:block hidden"></span>
          </a>
        </li>
        <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-primary-200 text-gray-800 hover:text-primary-600 px-4 py-3 lg:py-2 flex items-center nav-typography rounded-lg lg:rounded-none hover:bg-primary-50 lg:hover:bg-white/10 transition-all duration-200 relative group"
            href="{{ lang_prefix }}/glossary">
            <i class="lg:text-primary-200 text-primary-500 fas fa-book text-sm mr-3 group-hover:scale-110 transition-transform duration-200"></i>
            {% if current_lang == "zh" %}术语表{% else %}Glossary{% endif %}
            <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary-400 group-hover:w-full transition-all duration-300 lg:block hidden"></span>
          </a>
        </li>
        <!-- <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-gray-300 text-gray-800 px-3 py-4 lg:py-2 flex items-center text-xs uppercase font-bold"
            href="{{ lang_prefix }}/disclosure"><i class="lg:text-gray-300 text-gray-500 fas fa-file-contract text-lg leading-lg mr-2"></i>
            {% include translate.html key='nav.disclosure' %}</a>
        </li> -->
        <li class="flex items-center">
          <a class="lg:text-white lg:hover:text-primary-200 text-gray-800 hover:text-primary-600 px-4 py-3 lg:py-2 flex items-center nav-typography rounded-lg lg:rounded-none hover:bg-primary-50 lg:hover:bg-white/10 transition-all duration-200 relative group"
            href="{{ lang_prefix }}/contact-us">
            <i class="lg:text-primary-200 text-primary-500 fas fa-envelope text-sm mr-3 group-hover:scale-110 transition-transform duration-200"></i>
            {% include translate.html key='nav.contact' %}
            <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-primary-400 group-hover:w-full transition-all duration-300 lg:block hidden"></span>
          </a>
        </li>
        <li class="flex items-center lg:hidden">
          <button class="search-trigger text-gray-800 hover:text-primary-600 px-4 py-3 flex items-center nav-typography rounded-lg hover:bg-primary-50 transition-all duration-200 group">
            <i class="text-primary-500 fas fa-search text-sm mr-3 group-hover:scale-110 transition-transform duration-200"></i>
            {% if current_lang == "zh" %}搜索{% else %}Search{% endif %}
          </button>
        </li>
      </ul>
      
      <!-- Enhanced Search Button -->
      <div class="hidden lg:flex items-center ml-6">
        <button class="search-trigger text-white hover:text-primary-200 p-3 rounded-xl hover:bg-white/10 transition-all duration-200 group" 
                title="{% if current_lang == 'zh' %}搜索 (Ctrl+K){% else %}Search (Ctrl+K){% endif %}">
          <i class="fas fa-search text-lg group-hover:scale-110 transition-transform duration-200"></i>
        </button>
      </div>
      
      <!-- Enhanced Language Switcher -->
      <div class="hidden lg:flex items-center ml-4">
        <div class="bg-white/10 rounded-xl p-1">
          {% include language-switcher.html %}
        </div>
      </div>
    </div>
  </div>
</nav>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('example-collapse-navbar');
  const menuIcon = document.getElementById('menu-icon');
  const navbar = document.getElementById('main-navbar');
  
  // Mobile menu functionality
  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener('click', function() {
      // Toggle the hidden class
      mobileMenu.classList.toggle('hidden');
      
      // Toggle the menu icon between bars and times
      if (mobileMenu.classList.contains('hidden')) {
        menuIcon.className = 'text-white fas fa-bars';
      } else {
        menuIcon.className = 'text-white fas fa-times';
      }
    });
    
    // Close menu when clicking on a link (for better UX)
    const menuLinks = mobileMenu.querySelectorAll('a');
    menuLinks.forEach(function(link) {
      link.addEventListener('click', function() {
        mobileMenu.classList.add('hidden');
        menuIcon.className = 'text-white fas fa-bars';
      });
    });
  }
  
  // Enhanced scroll behavior with modern effects
  let lastScrollTop = 0;
  let ticking = false;
  
  function updateNavbar() {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    
    // Enhanced background blur and opacity when scrolled
    if (scrollTop > 50) {
      navbar.style.background = 'rgba(15, 23, 42, 0.98)';
      navbar.style.backdropFilter = 'blur(20px)';
      navbar.style.borderBottom = '1px solid rgba(255, 255, 255, 0.1)';
      navbar.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1)';
    } else {
      navbar.style.background = 'rgba(15, 23, 42, 0.95)';
      navbar.style.backdropFilter = 'blur(20px)';
      navbar.style.borderBottom = '1px solid rgba(255, 255, 255, 0.1)';
      navbar.style.boxShadow = 'none';
    }
    
    // Smooth show/hide with enhanced animations
    if (scrollTop <= 100) {
      navbar.style.transform = 'translateY(0)';
      navbar.style.opacity = '1';
    }
    else if (scrollTop > lastScrollTop && scrollTop > 100) {
      navbar.style.transform = 'translateY(-100%)';
      navbar.style.opacity = '0.95';
    }
    else if (scrollTop < lastScrollTop) {
      navbar.style.transform = 'translateY(0)';
      navbar.style.opacity = '1';
    }
    
    lastScrollTop = scrollTop;
    ticking = false;
  }
  
  function requestTick() {
    if (!ticking) {
      requestAnimationFrame(updateNavbar);
      ticking = true;
    }
  }
  
  // Listen for scroll events
  window.addEventListener('scroll', requestTick, { passive: true });
  
  // Also handle resize events to ensure proper behavior
  window.addEventListener('resize', function() {
    // Reset navbar position on resize
    if (window.innerWidth >= 1024) { // lg breakpoint
      navbar.style.transform = 'translateY(0)';
    }
  });
});
</script>